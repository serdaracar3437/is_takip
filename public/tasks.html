<!DOCTYPE html>
<div class="header">Görev Listesi</div>
<div class="wrap">


<div class="filter">
<input id="f_username" placeholder="Personel" />
<input id="f_isemri" placeholder="İş Emri No" />
<input id="f_tarih" type="date" />
<button onclick="loadTasks()">Filtrele</button>
<a href="personel.html" style="background:#2c003e;color:white;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:700;">Yeni Görev</a>
</div>


<table>
<thead>
<tr>
<th>Personel</th>
<th>İş Emri</th>
<th>Ürün</th>
<th>Tarih</th>
<th>Faaliyet</th>
<th>Adet</th>
<th>Hata</th>
</tr>
</thead>
<tbody id="taskTable"></tbody>
</table>


</div>


<script>
async function loadTasks(){
const q=new URLSearchParams({
username:f_username.value.trim(),
isemri_numarasi:f_isemri.value.trim(),
tarih:f_tarih.value||""
});


const res=await fetch("/api/tasks?"+q.toString());
const data=await res.json();
const tbody=taskTable;
tbody.innerHTML="";


if(!Array.isArray(data)||data.length===0){
tbody.innerHTML="<tr><td colspan='7' style='text-align:center;padding:20px;color:#777'>Kayıt bulunamadı</td></tr>";
return;
}


data.forEach(t=>{
const hatalar=[
t.hata_kodu1?`${t.hata_kodu1} (${t.hata_sayisi1||0})`:null,
t.hata_kodu2?`${t.hata_kodu2} (${t.hata_sayisi2||0})`:null,
t.hata_kodu3?`${t.hata_kodu3} (${t.hata_sayisi3||0})`:null,
].filter(Boolean).join("<br>");


const tr=document.createElement("tr");
tr.innerHTML=`
<td>${t.username}</td>
<td>${t.isemri_numarasi||"-"}</td>
<td>${t.urun_kodu||"-"}</td>
<td>${t.tarih||"-"}</td>
<td>${t.yapilan_faaliyet||"-"}</td>
<td>${t.islem_adedi||"-"}</td>
<td>${hatalar||"-"}</td>
`;
tbody.appendChild(tr);
});
}


loadTasks();
</script>
</body>
</html>