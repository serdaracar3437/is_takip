<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Görev Listesi</title>
<style>

/* ----------- GLOBAL TASARIM ----------- */

body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f4f6fc;
  margin: 0;
  padding: 0;
}

.header {
  background: #2c003e;
  color: white;
  padding: 20px;
  font-size: 24px;
  text-align: center;
  font-weight: bold;
}

/* ----------- FİLTRE KUTUSU ----------- */

.filter-box {
  background: white;
  width: 90%;
  max-width: 900px;
  margin: 25px auto;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0px 3px 12px rgba(0,0,0,0.1);
}

.filter-box input {
  width: 31%;
  padding: 10px;
  margin: 5px 1%;
  border-radius: 6px;
  border: 1px solid #ddd;
}

/* ----------- TABLO TASARIMI ----------- */

.table-container {
  width: 95%;
  margin: auto;
  margin-top: 20px;
  overflow-x: auto;
}

table {
  width: 100%;
  background: white;
  border-radius: 12px;
  border-collapse: collapse;
  box-shadow: 0px 2px 10px rgba(0,0,0,0.1);
}

thead {
  background: #ff6f00;
  color: white;
}

th, td {
  padding: 12px;
  border-bottom: 1px solid #eee;
  text-align: center;
}

tr:hover {
  background: #fff4e6;
}

/* ----------- BUTON ----------- */

.back-btn {
  display: block;
  margin: 25px auto;
  background: #2c003e;
  color: white;
  padding: 12px 25px;
  border-radius: 8px;
  width: 200px;
  text-align: center;
  text-decoration: none;
  font-weight: bold;
}

.back-btn:hover {
  background: #47005f;
}

</style>
</head>
<body>

<div class="header">Görev Listesi</div>

<div class="filter-box">
  <input type="text" id="f_username" placeholder="Personel">
  <input type="text" id="f_isemri" placeholder="İş Emri No">
  <input type="date" id="f_tarih">
  <button onclick="loadTasks()" style="
      margin-top:10px;
      padding:10px 20px;
      background:#ff6f00;
      border:none;
      color:white;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
  ">Filtrele</button>
</div>

<div class="table-container">
<table>
  <thead>
    <tr>
      <th>Adı</th>
      <th>İş Emri</th>
      <th>Ürün Kodu</th>
      <th>Tarih</th>
      <th>Faaliyet</th>
      <th>İşlem Adedi</th>
      <th>Hata</th>
    </tr>
  </thead>
  <tbody id="taskTable"></tbody>
</table>
</div>

<a class="back-btn" href="personel.html">Yeni Görev Oluştur</a>

<script>
async function loadTasks() {
  const filters = {
    username: document.getElementById("f_username").value,
    isemri_numarasi: document.getElementById("f_isemri").value,
    tarih: document.getElementById("f_tarih").value,
  };

  const res = await fetch("/api/tasks?" + new URLSearchParams(filters));
  const data = await res.json();

  const table = document.getElementById("taskTable");
  table.innerHTML = "";

  data.forEach(t => {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${t.username}</td>
      <td>${t.isemri_numarasi ?? "-"}</td>
      <td>${t.urun_kodu ?? "-"}</td>
      <td>${t.tarih ?? "-"}</td>
      <td>${t.yapilan_faaliyet ?? "-"}</td>
      <td>${t.islem_adedi ?? "-"}</td>
      <td>
         ${t.hata_kodu1 ? t.hata_kodu1 + " (" + t.hata_sayisi1 + ")" : ""}
         ${t.hata_kodu2 ? "<br>" + t.hata_kodu2 + " (" + t.hata_sayisi2 + ")" : ""}
         ${t.hata_kodu3 ? "<br>" + t.hata_kodu3 + " (" + t.hata_sayisi3 + ")" : ""}
      </td>
    `;
    table.appendChild(tr);
  });
}

// Sayfa açılır açılmaz yükle
loadTasks();
</script>

</body>
</html>
